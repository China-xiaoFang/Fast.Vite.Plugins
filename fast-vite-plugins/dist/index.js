import k from"fs";import P from"path";var E=t=>{let n=[];return k.readdirSync(t,{withFileTypes:!0}).forEach(l=>{if(l.isDirectory())n.push(...E(P.join(t,l.name)));else{let r=l.name.replace(".svg",""),g=k.readFileSync(P.join(t,l.name),"utf-8").replace(/<\?xml.*?\?>/,"").replace(/<!DOCTYPE svg.*?>/,"").trimStart().trimEnd().replace(/<svg([^>+].*?)>/,(c,m)=>{let f=m.match(/viewBox="[^"]+"/),i=m.match(/width="(\d+)"/),u=m.match(/height="(\d+)"/),v=1024,d=1024;i&&(v=i[0]),u&&(d=u[0]);let h="";return f?h=f[0]:h=`viewBox="0 0 ${v} ${d}"`,`<svg xmlns="http://www.w3.org/2000/svg" ${h}>`});n.push({iconName:r,componentName:r.charAt(0).toUpperCase()+r.slice(1),iconContent:g})}}),n.sort((l,r)=>l.iconName<r.iconName?-1:l.iconName>r.iconName?1:0)},W=(t,n,o)=>{k.mkdirSync(n,{recursive:!0});let l=`import { defineComponent } from "vue";

/**
 * ${t} \u56FE\u6807\u7EC4\u4EF6
 */
export const ${t} = defineComponent({
	name: "${t}",
	render() {
		return (
${o.split(`
`).map(r=>`			${r}`).join(`
`)}
		);
	},
});

export default ${t};
`;k.writeFileSync(P.join(n,"index.tsx"),l)};function Q(t,n){if(!t||!n)return;let o,l=()=>{let r=E(P.resolve(o.root,t)),g=P.resolve(o.root,n);k.mkdirSync(g,{recursive:!0});let c="",m="",f="";r.forEach((i,u)=>{W(i.componentName,P.join(g,i.iconName),i.iconContent),c+=`import { ${i.componentName} } from "./${i.iconName}";
`,m+=`	${i.componentName},`,f+=`export * from "./${i.iconName}";
`,u+1<r.length&&(m+=`
`)}),k.writeFileSync(P.join(g,"index.ts"),`import type { DefineComponent } from "vue";
${c}
${f}
export default [
${m}
] as unknown as DefineComponent[];
`)};return{name:"fast-vite-plugin-build-svg-icon",configResolved:r=>{o=r},buildStart(){l()},configureServer(r){let g=P.resolve(o.root,t);if(k.existsSync(g)){r.watcher.add(g);let c=m=>{m&&m.endsWith(".svg")&&l()};r.watcher.on("add",c),r.watcher.on("change",c),r.watcher.on("unlink",c)}}}}import T from"fs";import J from"path";import V from"rollup-plugin-external-globals";import{viteExternalsPlugin as _}from"vite-plugin-externals";var B=process.env.NODE_ENV==="development";function G(t){let n=process.cwd(),o=J.join(n,"node_modules",t,"package.json");return T.existsSync(o)?JSON.parse(T.readFileSync(o,"utf8")).version:""}function M(t){return!!(t.startsWith("http:")||t.startsWith("https:")||t.startsWith("//"))}function U(t,n){let{path:o}=n;return M(o)&&(t=o),t.replace(/\{name\}/g,n.name).replace(/\{version\}/g,n.version).replace(/\{path\}/g,o)}function H(t,n){n=t.prodUrl||n;let o=t,l=t.version||G(o.name),r=[];Array.isArray(o.path)?r=o.path:r.push(o.path);let g={...o,version:l};r=r.map(f=>{if(!l&&!M(f))throw new Error(`modules: ${g.name} package.json file does not exist`);return U(n,{name:g.name,version:g.version,path:f})});let c=o.css||[];!Array.isArray(c)&&c&&(c=[c]);let m=Array.isArray(c)?c.map(f=>U(n,{name:g.name,version:g.version,path:f})):[];return{...o,version:l,pathList:r,cssList:m}}var z="https://cdn.jsdelivr.net/npm/{name}@{version}/{path}",st="https://unpkg.com/{package}@{version}/{path}";function it(t){let{modules:n=[],prodUrl:o=z,enableInDevMode:l=!1,generateCssLinkTag:r,generateScriptTag:g}=t,c=!1,m=(Array.isArray(n)?n:[n]).map(u=>typeof u=="function"?u(o):u).map(u=>H(u,o)),f={};m.forEach(u=>{f[u.name]=u.var,Array.isArray(u.alias)&&u.alias.forEach(v=>{f[v]=u.var})});let i=[{name:"fast-vite-plugin-cdn-import",enforce:"pre",config(u,{command:v}){c=v==="build";let d={build:{rollupOptions:{plugins:[]}}};return c&&(d.build.rollupOptions.plugins=[V(f)]),d},transformIndexHtml(u){if(!c&&!l)return u;let v=[];return m.forEach(d=>{d.pathList.forEach(h=>{let w=g?.(d.name,h)||{},p={src:h,crossorigin:"anonymous",...d?.attrs??{},...w.attrs};v.push({tag:"script",attrs:p,...w})}),d.cssList.forEach(h=>{let w=r?.(d.name,h)||{},p={href:h,rel:"stylesheet",crossorigin:"anonymous",...d?.attrs??{},...w.attrs};v.push({tag:"link",attrs:p,...w})})}),v}}];return B&&l&&i.push(_(f,{enforce:"pre"})),i}import S from"fs";import C from"path";function O(t){return t.replace(/\\/g,"/")}function L(t){return t.replace(/[-_](\w)/g,(n,o)=>o?o.toUpperCase():"").replace(/^\w/,n=>n.toUpperCase())}function ut(t={}){let{dir:n="src/components",exportPath:o="src/components/index.ts",dts:l=!0,dtsPath:r="types/components.d.ts",deep:g=!0,extensions:c=["vue","tsx","jsx"],formatter:m}=t,f,i=new Map,u=p=>{let s=p;for(let a of c)if(s.endsWith(`.${a}`)){s=s.slice(0,-a.length-1);break}if(s.endsWith("/index")||s.endsWith("\\index")){let a=s.split(/[\\/]/);s=a[a.length-2]||a[a.length-1]}else{let a=s.split(/[\\/]/);s=a[a.length-1]}return m?m(s):L(s)},v=(p,s=0)=>{let a=[];if(!S.existsSync(p))return a;let e=S.readdirSync(p,{withFileTypes:!0});for(let y of e){let $=C.join(p,y.name);if(y.isDirectory()){if(y.name==="node_modules"||y.name.startsWith(". "))continue;(g||s===0)&&a.push(...v($,s+1))}else if(y.isFile()){let x=C.extname(y.name).slice(1);c.includes(x)&&a.push($)}}return a},d=()=>{i.clear();let p=C.resolve(f.root,n);if(!S.existsSync(p)){console.warn(`[component-auto-import] Directory not found: ${p}`);return}v(p).forEach(a=>{let e=C.relative(p,a),y=u(e);i.set(y,{name:y,from:a})})},h=()=>{if(i.size===0)return;let p=Array.from(i.values()).sort((x,N)=>x.name.localeCompare(N.name)),s=C.resolve(f.root,o),a=C.dirname(s),e=[];e.push("/* eslint-disable */"),e.push("/* prettier-ignore */"),e.push("// @ts-nocheck"),e.push("// Auto-generated by fast component-auto-import"),e.push("// Generated by fast-vite-plugins"),e.push("// Do not edit this file manually"),e.push(""),e.push('import type { App } from "vue";'),e.push(""),p.forEach(({name:x,from:N})=>{let b=O(C.relative(a,N)),R=b.startsWith(".")?b:`./${b}`;e.push(`import ${x} from "${R}";`),e.push(`export { ${x} };`),e.push(`export type ${x}Instance = InstanceType<typeof ${x}>;`)}),e.push(""),e.push("/** \u81EA\u52A8\u6CE8\u518C\u6240\u6709\u7EC4\u4EF6 */"),e.push("export function registerComponents(app: App): void {"),p.forEach(({name:x})=>{e.push(`	app.component(${x}.name, ${x});`)}),e.push("}"),e.push("");let y=`${e.join(`
`)}
`,$=S.existsSync(s)?S.readFileSync(s,"utf-8"):"";y!==$&&S.writeFileSync(s,y,"utf-8")},w=()=>{if(!l||i.size===0)return;let p=Array.from(i.values()).sort((x,N)=>x.name.localeCompare(N.name)),s=C.resolve(f.root,r),a=C.dirname(s),e=[];e.push("// For this project development"),e.push("// Auto-generated by fast component-auto-import"),e.push("// Generated by fast-vite-plugins"),e.push("// Do not edit this file manually"),e.push(""),e.push('import "@vue/runtime-core";'),e.push(""),e.push("// GlobalComponents for Volar"),e.push('declare module "@vue/runtime-core" {'),e.push("	export interface GlobalComponents {"),p.forEach(({name:x,from:N})=>{let b=O(C.relative(a,N)),R=b.startsWith(".")?b:`./${b}`;e.push(`		${x}: (typeof import("${R}"))["default"];`)}),e.push("	}"),e.push("}"),e.push(""),e.push("export {};");let y=`${e.join(`
`)}
`;S.existsSync(a)||S.mkdirSync(a,{recursive:!0});let $=S.existsSync(s)?S.readFileSync(s,"utf-8"):"";y!==$&&S.writeFileSync(s,y,"utf-8")};return{name:"fast-vite-plugin-component-auto-import",enforce:"post",configResolved:p=>{f=p},buildStart(){d(),h(),w()},configureServer(p){let s=C.resolve(f.root,n);if(S.existsSync(s)){p.watcher.add(s);let a=e=>{if(!e||e.endsWith(".d.ts"))return;let y=C.extname(e).slice(1);c.includes(y)&&(d(),h(),w())};p.watcher.on("add",a),p.watcher.on("change",a),p.watcher.on("unlink",a)}}}}import F from"fs";import D from"path";function Y(t){return t.replace(/[-_](\w)/g,(n,o)=>o?o.toUpperCase():"").replace(/^\w/,n=>n.toUpperCase())}function Z(t){let n=/defineOptions\(\s*\{\s*name:\s*["']([^"']+)["']/,o=t.match(n);return o?o[1]:null}function gt(t={}){let{dir:n="src/views",exportPath:o="src/router/index.json",deep:l=!0,extensions:r=["vue","tsx","jsx"],formatter:g}=t,c,m=(i,u=[])=>(F.existsSync(i)&&F.readdirSync(i).forEach(d=>{let h=D.join(i,d);if(F.statSync(h).isDirectory())l&&m(h,u);else{let p=D.extname(h).slice(1);r.includes(p)&&u.push(h)}}),u),f=()=>{let i=D.resolve(c.root,n),v=m(i).reduce((p,s)=>{try{let a=F.readFileSync(s,"utf-8"),e=Z(a),y=`/${D.relative(c.root,s).replace(/\\/g,"/")}`,$;if(e)$=e;else{let x=D.basename(s,D.extname(s));$=g?g(x):Y(x)}p[y]=$}catch(a){console.error(`Error processing file ${s}:`,a)}return p},{}),d=D.resolve(c.root,o),h=D.dirname(d);F.existsSync(h)||F.mkdirSync(h,{recursive:!0});let w=JSON.stringify(v,null,2);F.writeFileSync(d,w,"utf-8")};return{name:"fast-vite-plugin-router-path",enforce:"post",configResolved:i=>{c=i},buildStart(){f()},configureServer(i){let u=D.resolve(c.root,n);if(F.existsSync(u)){i.watcher.add(u);let v=d=>{if(!d||d.endsWith(".d.ts")||d.endsWith(".json"))return;let h=D.extname(d).slice(1);r.includes(h)&&f()};i.watcher.on("add",v),i.watcher.on("change",v),i.watcher.on("unlink",v)}}}}import j from"fs";import I from"path";function A(t,n=2){return t.toString().padStart(n,"0")}function X(t){let n=t.getUTCFullYear(),o=A(t.getUTCMonth()+1),l=A(t.getUTCDate()),r=A(t.getUTCHours()),g=A(t.getUTCMinutes()),c=A(t.getUTCSeconds()),m=A(t.getUTCMilliseconds(),3);return`Z ${n}-${o}-${l} ${r}:${g}:${c}.${m}`}function yt(t){let n;return{name:"fast-vite-plugin-version-update",configResolved:o=>{n=o},buildStart(){let l=X(new Date),r=n.publicDir,g=I.join(r,"version.json");j.existsSync(r)||j.mkdirSync(r);let c=JSON.stringify({version:`v${t}`,dateTime:l},null,4);j.writeFileSync(g,c);let m=I.join(n.base,"package.json");if(j.existsSync(m)){let f=JSON.parse(j.readFileSync(m,"utf-8"));f.version=t,j.writeFileSync(m,JSON.stringify(f,null,2),"utf-8")}}}}export{gt as buildRouterPath,Q as buildSvgIcon,it as cdnImport,z as cdnJsDelivrUrl,st as cdnUnpkgUrl,ut as componentAutoImport,E as findSvgFile,yt as versionUpdatePlugin,W as writeTSXIcon};
//# sourceMappingURL=index.js.map